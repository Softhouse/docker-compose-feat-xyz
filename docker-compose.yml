version: '2'
services:
    mongodb:
        image: mongo
        expose:
         - 27017
        volumes:
         - /var/mongo/db:/data/db
        restart: unless-stopped
    katalog:
        image: joakimbeng/katalog
        expose:
         - 5005
        privileged: true
        volumes:
         - /var/run/docker.sock:/var/run/docker.sock
         - /var/katalog/data:/app/data
         - /var/katalog/nginx:/app/nginx
        restart: unless-stopped
    sitewatcher:
        build: github.com/letterix/nginx-site-watcher.git
        expose:
         - 80
        volumes:
         - /var/katalog/nginx:/etc/nginx/sites-enabled
        restart: unless-stopped
    api:
        build: github.com/Softhouse/laughing-batman.git
        links:
         - mongodb
        env_file: github_secret.env
        environment:
         - KATALOG_VHOSTS=default/api
         - MONGO_HOST=mongodb
    builder:
        build: github.com/Softhouse/flaming-computing-machine.git
        links:
         - mongodb
         - sitewatcher:xyz
        volumes:
        - /var/run/docker.sock:/var/run/docker.sock
        - /usr/bin/docker:/usr/bin/docker
        - ./builder/ssh:/ssh
        env_file: github_secret.env
        environment:
         - MONGO_HOST=mongodb
         - SITEWATCHER_HOST=xyz
        restart: unless-stopped
    proxy:
        build: proxy
        ports:
         - 80:80
        links:
         - sitewatcher
        restart: unless-stopped
